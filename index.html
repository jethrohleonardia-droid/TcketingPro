<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro-Ticket System (GCash Ready)</title>
    <style>
        :root { --primary: #0056e0; --success: #28a745; --dark: #1a1a1a; }
        body { font-family: 'Segoe UI', sans-serif; background: #f8f9fa; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 100%; max-width: 400px; margin-bottom: 20px; }
        h2 { margin-top: 0; color: var(--dark); font-size: 1.5rem; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        input, select { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; margin-top: 10px; }
        
        .btn-pay { background: var(--primary); color: white; }
        .btn-admin { background: #6c757d; color: white; }
        .gcash-box { background: #e7f0ff; padding: 15px; border-radius: 10px; text-align: center; margin: 10px 0; border: 2px dashed #0056e0; }
        .qr-placeholder { background: #ccc; width: 150px; height: 150px; margin: 10px auto; display: flex; align-items: center; justify-content: center; font-size: 12px; }
        
        #adminDashboard { max-width: 900px; width: 100%; display: none; }
        table { width: 100%; border-collapse: collapse; background: white; }
        th, td { padding: 12px; border: 1px solid #eee; text-align: left; }
        .receipt-img { width: 50px; cursor: pointer; border-radius: 4px; }
        .status-pending { color: #f39c12; font-weight: bold; }
        .status-approved { color: #27ae60; font-weight: bold; }

        /* Modal for viewing receipt */
        #imgModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:1000; }
        #imgModal img { max-width: 90%; max-height: 90%; border-radius: 10px; }
    </style>
</head>
<body>

    <div class="card" id="purchaseCard">
        <h2>üéüÔ∏è Get Your Tickets</h2>
        <div class="gcash-box">
            <p style="margin:0; font-weight:bold; color:#0056e0;">GCash Payment</p>
            <div class="qr-placeholder">YOUR GCASH QR HERE</div>
            <small>Scan and pay <b>‚Ç±50.00</b></small>
        </div>

        <label>Full Name</label>
        <input type="text" id="custName" placeholder="Enter your name">
        
        <label>Upload Receipt Screenshot</label>
        <input type="file" id="receiptFile" accept="image/*">
        
        <button class="btn-pay" onclick="submitRequest()">Submit for Verification</button>
        <div id="userFeedback"></div>
    </div>

    <div class="card">
        <h2>üîç Ticket Tracker</h2>
        <p>Enter your name to check status:</p>
        <input type="text" id="trackName" placeholder="Exact name used">
        <button onclick="trackTicket()" style="background:#333; color:white;">Check My Ticket</button>
        <div id="trackResult"></div>
    </div>

    <button class="btn-admin" style="width:200px" onclick="showLogin()">Admin Dashboard</button>

    <div id="adminDashboard" class="card">
        <h2>üìä Admin Management</h2>
        <button onclick="logout()" style="width:100px; background:#dc3545; color:white; margin-bottom:10px;">Logout</button>
        <table>
            <thead>
                <tr>
                    <th>Customer</th>
                    <th>Receipt</th>
                    <th>Status</th>
                    <th>Action/Code</th>
                </tr>
            </thead>
            <tbody id="adminTableBody"></tbody>
        </table>
    </div>

    <div id="imgModal" onclick="this.style.display='none'"><img id="modalImg"></div>

    <script>
        let db = JSON.parse(localStorage.getItem('onlineTickets')) || [];

        // 1. BUYER: Submit payment proof
        function submitRequest() {
            const name = document.getElementById('custName').value.trim();
            const fileInput = document.getElementById('receiptFile');
            const feedback = document.getElementById('userFeedback');

            if (!name || !fileInput.files[0]) {
                alert("Please provide name and receipt screenshot.");
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const newRequest = {
                    id: Date.now(),
                    name: name,
                    receipt: e.target.result, // Base64 string of the image
                    status: 'Pending',
                    code: null
                };
                db.push(newRequest);
                save();
                feedback.innerHTML = `<p style="color:green; font-weight:bold;">Sent! Wait for admin to verify.</p>`;
                document.getElementById('custName').value = "";
                fileInput.value = "";
            };
            reader.readAsDataURL(fileInput.files[0]);
        }

        // 2. TRACKER: User checks their code
        function trackTicket() {
            const name = document.getElementById('trackName').value.trim();
            const result = document.getElementById('trackResult');
            const ticket = db.find(t => t.name.toLowerCase() === name.toLowerCase());

            if (!ticket) {
                result.innerHTML = `<p style="color:red;">No record found.</p>`;
            } else if (ticket.status === 'Pending') {
                result.innerHTML = `<p style="color:orange;">Still Pending Admin Approval...</p>`;
            } else {
                result.innerHTML = `<div style="background:#d4edda; padding:10px; border:2px dashed green; text-align:center;">
                    <small>VALID TICKET CODE:</small><br><strong>${ticket.code}</strong>
                </div>`;
            }
        }

        // 3. ADMIN: Management
        function showLogin() {
            const pass = prompt("Admin Password:");
            if (pass === "admin123") {
                document.getElementById('adminDashboard').style.display = "block";
                document.getElementById('purchaseCard').style.display = "none";
                renderAdmin();
            }
        }

        function renderAdmin() {
            const tbody = document.getElementById('adminTableBody');
            tbody.innerHTML = "";
            db.forEach(t => {
                const action = t.status === 'Pending' 
                    ? `<button onclick="approve(${t.id})" style="background:green; color:white; padding:5px;">Approve</button>` 
                    : `<code>${t.code}</code>`;

                tbody.innerHTML += `
                    <tr>
                        <td>${t.name}</td>
                        <td><img src="${t.receipt}" class="receipt-img" onclick="viewImg('${t.receipt}')"></td>
                        <td class="status-${t.status.toLowerCase()}">${t.status}</td>
                        <td>${action}</td>
                    </tr>
                `;
            });
        }

        function approve(id) {
            const ticket = db.find(t => t.id === id);
            ticket.status = "Approved";
            ticket.code = "TIX-" + Math.random().toString(36).substr(2, 6).toUpperCase();
            save();
            renderAdmin();
        }

        function viewImg(src) {
            document.getElementById('imgModal').style.display = "flex";
            document.getElementById('modalImg').src = src;
        }

        function save() { localStorage.setItem('onlineTickets', JSON.stringify(db)); }
        function logout() { location.reload(); }
    </script>
</body>
</html>